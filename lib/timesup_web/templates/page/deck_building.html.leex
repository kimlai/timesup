<section class="deck-building">
  <h1>Mise en place</h1>
  <div>Pour inviter des personnes à rejoindre la partie, envoyez-leur ce lien :
    <a href="<%= Routes.page_url(TimesupWeb.Endpoint, :choose_username, @game.id) %>"/>
      <%= Routes.page_url(TimesupWeb.Endpoint, :choose_username, @game.id) %>
    </a>
  </div>
  <h2>Joueurs connectés</h2>
  <div>
  <ul class="player-list">
    <%= for player <- Timesup.GameState.get_players(@game) do %>
      <li class="player">
        <%= player.name %>
        <%= if player.ready do %> (prêt.e)<% end %>
        <%= if player.name == @current_user do %> (vous)<% end %>
      </li>
    <% end %>
  </ul>
  </div>

  <%= if Timesup.GameState.all_players_ready?(@game) do %>
    <div>Tout le monde est prêt</div>
    <%= f = form_for :choose_teams, "#", [phx_submit: :start_choosing_teams] %>
      <%= submit "Choisir les équipes" %>
    </form>
  <% else %>
    <%= if Timesup.GameState.player_ready?(@game, @current_user) do %>
      <div>En attente des autres joueurs</div>
    <% end %>
  <% end %>

  <h2>Les cartes</h2>
    <div>
      <p>Vous décidez entre vous du nombre de cartes que chaque joueur écrit.</p>
      <div>Nombre total de cartes : <%= Timesup.GameState.number_of_cards(@game) %></div>
    </div>
    <%= if length(Timesup.GameState.get_player_cards(@game, @current_user)) > 0 && !Timesup.GameState.player_ready?(@game, @current_user) do %>
      <%= f = form_for :ready, "#", [phx_submit: :set_player_ready] %>
        <%= submit "Je suis prêt.e" %>
      </form>
    <% end %>
    <%= f = form_for :card, "#", [phx_submit: :add_card, class: "add-card-form"] %>
      <div>
        <%= label f, :name, "Nouvelle carte" %>
        <%= text_input f, :name, placeholder: "exemple: Beyoncé, Dijkstra..." %>
      </div>
      <%= submit "Ajouter" %>
    </form>
  <div>
    <ul class="card-list">
      <%= for card <- Timesup.GameState.get_player_cards(@game, @current_user) do %>
        <li class="card"><%= card %></li>
      <% end %>
    </ul>
  </div>
</section>
